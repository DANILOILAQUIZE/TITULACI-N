{% extends 'base.html' %}
{% load static %}

{% block title %}Comprobante de Votación - {{ carnet.proceso_electoral }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white text-center py-3">
                    <h3 class="mb-0">COMPROBANTE DE VOTACIÓN</h3>
                    <h5 class="mb-0">ESCEULA RIOBAMBA</h5>
                </div>
                
                <div class="card-body">
                    <!-- Logo y Título -->
                    <div class="text-center mb-4">
                        <img src="{% static 'img/logo-uer.png' %}" alt="Logo UER" style="height: 80px;" class="mb-2">
                        <h4 class="text-primary">Sistema de Votación Electrónica</h4>
                    </div>
                    
                    <div class="row">
                        <!-- Información del Votante -->
                        <div class="col-md-7">
                            <div class="voter-info p-3 mb-3" style="border: 1px solid #dee2e6; border-radius: 5px;">
                                <h5 class="text-center mb-3">INFORMACIÓN DEL VOTANTE</h5>
                                <div class="mb-2">
                                    <span class="fw-bold">NOMBRE COMPLETO:</span>
                                    <div class="p-2 bg-light rounded">
                                        {{ carnet.nombre_completo|upper }}
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <span class="fw-bold">CÉDULA:</span>
                                    <div class="p-2 bg-light rounded">
                                        {{ carnet.cedula }}
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <span class="fw-bold">PROCESO ELECTORAL:</span>
                                    <div class="p-2 bg-light rounded">
                                        {{ carnet.proceso_electoral|upper }}
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <span class="fw-bold">FECHA Y HORA:</span>
                                    <div class="p-2 bg-light rounded">
                                        {{ carnet.fecha_votacion|date:"d/m/Y H:i:s" }}
                                    </div>
                                </div>
                                <div class="mt-3 text-center">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle"></i> 
                                        Este documento es su comprobante de votación
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Código QR -->
                        <div class="col-md-5 text-center">
                            <div class="qr-container p-3 mb-3" style="border: 1px solid #dee2e6; border-radius: 5px; height: 100%;">
                                <h5 class="mb-3">CÓDIGO DE VERIFICACIÓN</h5>
                                <div class="qr-code mb-3">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data={{ carnet.codigo_verificacion }}" 
                                         alt="Código QR de Verificación" 
                                         class="img-fluid">
                                </div>
                                <div class="verification-code p-2 bg-light rounded">
                                    <small class="text-muted">Código:</small><br>
                                    <strong>{{ carnet.codigo_verificacion|slice:":8" }}...{{ carnet.codigo_verificacion|slice:"-8:" }}</strong>
                                </div>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <i class="fas fa-qrcode"></i> Escanee este código para verificar
                                    </small>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <button onclick="window.print()" class="btn btn-primary me-2">
                                    <i class="fas fa-print me-1"></i> Imprimir
                                </button>
                                <a href="{% url 'administracion:index' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-home me-1"></i> Inicio
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-muted text-center">
                    <small>Fecha de emisión: {{ fecha_emision }} - Sistema de Votación UE Riobamba</small>
                </div>
            </div>
            
            <div class="alert alert-warning mt-3 d-print-none">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Importante:</strong> Este comprobante es personal e intransferible. No lo comparta con terceros.
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .card, .card * {
            visibility: visible;
        }
        .card {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            border: none !important;
            box-shadow: none !important;
        }
        .d-print-none, .d-print-none * {
            display: none !important;
        }
        .btn {
            display: none !important;
        }
    }
    
    .card {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .card-header {
        border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }
    
    #qrcode {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
    }
</style>

{% endblock %}

{% block extra_js %}
<script>
    // Código para generar el QR dinámicamente (opcional)
    document.addEventListener('DOMContentLoaded', function() {
        // Si prefieres generar el QR con JavaScript en lugar de usar la API
        // Puedes descomentar el siguiente código y eliminar la etiqueta img del HTML
        /*
        const qrCode = new QRCode(document.getElementById("qrcode"), {
            text: "{{ carnet.codigo_verificacion }}",
            width: 200,
            height: 200,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
        */
        
        // Forzar la impresión automática (opcional, descomentar si se desea)
        // setTimeout(function() { window.print(); }, 1000);
    });
</script>
{% endblock %}
